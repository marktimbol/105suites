jQuery.fn.print=function(){if(this.size()>1)return void this.eq(0).print();if(this.size()){var a="printer-"+(new Date).getTime(),b=jQuery("<iframe name='"+a+"'>");b.css("width","1px").css("height","1px").css("position","absolute").css("left","-9999px").appendTo(jQuery("body:first"));var c=window.frames[a],d=c.document,e=jQuery("<div>").append('<style type="text/css">*, * * {-webkit-box-sizing: border-box;-moz-box-sizing: border-box;box-sizing: border-box;}body {font-family:verdana;font-size:14px;}a{color:#000;text-decoration:none;}.table{width:100%;margin-bottom:20px;} .table thead {display:table-header-group;vertical-align:top;}.table th {padding:8px;line-height:20px;font-weight:700;}.text-right {text-align:right !important;} .table td {pading:8px;font-weight:400;border-top:1px solid #000;}.row{margin:0 -15px;}.row:after{float:none;clear:both;line-height:0;display:table;content:"";}.col-sm-6, .col-md-6{float:left;width:50%;padding:0 20px;position:relative;}.block table{text-align:left;margin-bottom:15px}.block table tr td,.block table tr th{border-bottom:1px solid #ddd;border-right:1px solid #ddd;padding:10px;line-height:normal;text-align:left}body h2.subtitle{font-size:24px!important;border-bottom:none;padding:15px 0 0;font-weight:400;line-height:1.4rem;color:#6B645A!important;margin-bottom:15px}h2{margin-bottom:15px !important;}table.booktable{border-top:3px solid #6B645A;margin-bottom:20px;width:99%}table.booktable tr{border-bottom:1px solid #6B645A}table.booktable tr td{padding:5px 0}table.booktable tr td.heading{min-width:80px;font-weight:700;color:#6B645A}table.booktable tr.noborder{border-bottom:none}table.booktable tr td.pricetd{padding-right:3px}</style>');d.open(),d.write('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">'),d.write("<html>"),d.write("<body>"),d.write("<head>"),d.write("<title>"),d.write(document.title),d.write("</title>"),d.write(e.html()),d.write("</head>"),d.write(this.html()),d.write("</body>"),d.write("</html>"),d.close(),c.focus(),c.print(),setTimeout(function(){b.remove()},6e4)}},jQuery(document).ready(function(a){jQuery("#booking_date_from").datepicker({dateFormat:"dd/mm/yy",onSelect:function(a){var b=moment(a,"DD/M/YYYY").add(1,"month"),f=(b._d.getDate(),b._d.getMonth(),b._d.getFullYear(),moment(b).format("DD/M/YYYY"));jQuery("#booking_date_to").datepicker("option","minDate",f)}}),jQuery("#booking_date_to").datepicker({dateFormat:"dd/mm/yy"}),jQuery("#ngappdiv").show()});var app=angular.module("searchBooking",["ngResource"]);app.controller("resultsCtl",["$scope","$http",function(a,b){a.results=[],a.totalfound=0,a.searching=1;a.selected=[];a.table_tr_ref_id="",a.table_tr_alt=0,a.checkedall=a.checkedany=0,a.showarchive=0,a.httprequest=0,a.showrowdata=function(a){return returnval="",a&&(returnval="hideel"),returnval};var d=function(b,c){"add"===b&&-1===a.selected.indexOf(c)&&a.selected.push(c),"remove"===b&&-1!==a.selected.indexOf(c)&&a.selected.splice(a.selected.indexOf(c),1),a.selected.length>0?a.showarchive=1:a.showarchive=0};a.updateSelection=function(a,b){var c=a.target,e=c.checked?"add":"remove";d(e,b)},a.selectAll=function(b){for(var c=b.target,e=c.checked?"add":"remove",f=0;f<a.results.length;f++){var g=a.results[f];d(e,g.booking_ref)}},a.getSelectedClass=function(b){return a.isSelected(b.booking_ref)?"selected":""},a.isSelected=function(b){return a.selected.indexOf(b)>=0},a.isSelectedAll=function(){return a.selected.length===a.results.length},a.init=function(){a.httprequest=1,b.get(reservation_object.url+"?action="+reservation_object.name+"_search_bookings&date_from="+jQuery("#booking_date_from").val()+"&date_to="+jQuery("#booking_date_to").val()).success(function(b,c){newdata=b,old_ref_id="",table_tr_alt=0,jQuery.each(b,function(a,b){b.booking_ref!=old_ref_id?(old_ref_id=b.booking_ref,newdata[a].same_ref_id=!1,table_tr_alt++,newdata[a].table_tr_alt=table_tr_alt%5):(newdata[a].same_ref_id=!0,newdata[a].table_tr_alt=table_tr_alt%5)}),a.results=newdata,a.totalfound=b.length,a.searching=a.checkedall=a.httprequest=0})},a.init(),a.search_bookings=function(){a.searching=1,b.get(reservation_object.url+"?action="+reservation_object.name+"_search_bookings&date_from="+jQuery("#booking_date_from").val()+"&date_to="+jQuery("#booking_date_to").val()).success(function(b,c){newdata=b,old_ref_id="",table_tr_alt=0,jQuery.each(b,function(a,b){b.booking_ref!=old_ref_id?(old_ref_id=b.booking_ref,newdata[a].same_ref_id=!1,table_tr_alt++,newdata[a].table_tr_alt=table_tr_alt%5):(newdata[a].same_ref_id=!0,newdata[a].table_tr_alt=table_tr_alt%5)}),a.results=newdata,a.totalfound=b.length,a.searching=a.checkedall=0})},a.bookingArchived=function(){var c={action:reservation_object.name+"_request_archive",booking_ref:a.selected};a.httprequest=1,b({url:reservation_object.url,method:"POST",data:jQuery.param(c),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(a,b){var c=angular.element("[ng-controller=resultsCtl]").scope();c.init(),c.selected=[],c.httprequest=0}).error(function(){alert("error");var a=angular.element("[ng-controller=resultsCtl]").scope();a.httprequest=0})}}]);var searchall=angular.module("searchallBooking",["ngResource"]);searchall.controller("resultsCtlall",["$scope","$http",function(a,b){a.results=[],a.totalfound=0,a.searching=1;a.selected=[];a.table_tr_ref_id="",a.table_tr_alt=0,a.checkedall=a.checkedany=0,a.showarchive=0,a.showrowdata=function(a){return returnval="",a&&(returnval="hideel"),returnval},a.init=function(){b.get(reservation_object.url+"?action="+reservation_object.name+"_search_bookings&getall=true&date_from="+jQuery("#booking_date_from").val()+"&date_to="+jQuery("#booking_date_to").val()).success(function(b,c){newdata=b,old_ref_id="",table_tr_alt=0,jQuery.each(b,function(a,b){b.booking_ref!=old_ref_id?(old_ref_id=b.booking_ref,newdata[a].same_ref_id=!1,table_tr_alt++,newdata[a].table_tr_alt=table_tr_alt%5):(newdata[a].same_ref_id=!0,newdata[a].table_tr_alt=table_tr_alt%5)}),a.results=newdata,a.totalfound=b.length,a.searching=a.checkedall=0})},a.init(),a.search_bookings=function(){a.searching=1,b.get(reservation_object.url+"?action="+reservation_object.name+"_search_bookings&date_from="+jQuery("#booking_date_from").val()+"&date_to="+jQuery("#booking_date_to").val()).success(function(b,c){newdata=b,old_ref_id="",table_tr_alt=0,jQuery.each(b,function(a,b){b.booking_ref!=old_ref_id?(old_ref_id=b.booking_ref,newdata[a].same_ref_id=!1,table_tr_alt++,newdata[a].table_tr_alt=table_tr_alt%5):(newdata[a].same_ref_id=!0,newdata[a].table_tr_alt=table_tr_alt%5)}),a.results=newdata,a.totalfound=b.length,a.searching=a.checkedall=0})}}]),jQuery(document).on("click",'input[name="receiver_email"]',function(a){"custom"==jQuery(this).val()&&jQuery(this).is(":checked")?jQuery(this).closest("form").find('input[name="bookingemail"]').stop().show():jQuery(this).closest("form").find('input[name="bookingemail"]').stop().hide()}),jQuery(document).on("click",".savebookingsettings",function(a){a.preventDefault();var b=jQuery(this).closest("form");jQuery.ajax({type:b.attr("method"),url:reservation_object.url,data:b.serialize(),error:function(){b.find(".spinner").remove(),alert("error")},dataType:"json",beforeSend:function(){b.append('<span class="spinner" />')},success:function(a){b.find(".spinner").remove(),a&&alert("option saved")}})});var globalisconfirm=0;jQuery(document).on("click",".bookingAction",function(a){if(c=confirm("Are You Sure ?"),c){var b=jQuery(this),d=JSON.parse(b.attr("data-info"));jQuery.ajax({type:"post",url:reservation_object.url,data:d,beforeSend:function(){b.closest("tr").append('<span class="spainner" />')},dataType:"json",success:function(a){if(b.closest("tr").find(".spainner").remove(),a.success){jQuery(".book-ref-"+d.ref_id).html(a.message);var c=angular.element("[ng-controller=resultsCtl]").scope();c.$apply(function(){for(i=0;i<c.results.length;i++)c.results[i].booking_ref==d.ref_id&&(newstatus="bookingCancelled"==d.action?"Cancelled":"Confirmed",c.results[i].status=newstatus)})}else alert(a.error)}}).fail(function(){alert("update, failed, please try again."),b.closest("tr").find(".spainner").remove()}).error(function(){alert("error"),b.closest("tr").find(".spainner").remove()})}}),jQuery(document).on("click",".thankprint",function(a){a.preventDefault(),jQuery("#bookOrder").print()});