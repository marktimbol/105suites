!function(a){var b,c,d,e;d=function(a,b){return function(){return a.apply(b,arguments)}},c={dateFormat:"dd-mm-yy",messagetemplate:'<div class="cb_hm_ajax_message_container"> {{#if status}} <span class="cb_hm_{{status}}"></span> {{/if}} {{message}} </div>',resulttemplate:'<thead> <tr class="monthhead"> <th colspan="2"></th> {{#each months}} <th class="month" colspan="{{colspan}}">{{title}}</th> {{/each}} </tr> <tr class=""> <th colspan="2"> <a href="javascript:void(0)" class="calendar-prev btn btn-warning"><i class="fa fa-chevron-left"></i></a> <a href="javascript:void(0)" class="calendar-next btn btn-warning"><i class="fa fa-chevron-right"></i></a> </th> {{#each days}} <th>{{title}}, {{value}}</th> {{/each}} </tr> </thead> <tbody> {{#each roomrate}} <tr> <td class="roomname">{{title}}</td> <td class="roomrate"> <label>Rooms</label> <label>Rate(rooms)</label> </td> {{#each rates}} <td> <input type="text" class="form-control" name="rooms[{{../roomid}}][{{day}}]" placeholder="0" value="{{available}}" /> <input type="text" class="form-control" name="rates[{{../roomid}}][{{day}}]" placeholder="0" value="{{price}}" /> </td> {{/each}} </tr> {{/each}} </tbody>',url:"admin-ajax.php",action:"getrates",dateFrom:"01-03-2015",dateTo:"10-03-2015",toolpanel:".ratepanel",name:null},b=function(b){function f(b,f){this.handler=b,this.resultdata={},this.formChange=!1,this.ajaxrequest=!1,a.extend(!0,this,c,f),this.update=d(this.update,this),this.onResize=d(this.onResize,this),this.init=d(this.init,this),this.clear=d(this.clear,this),e=this,this.autoResize&&a(window).bind("resize.cbedsRates",this.onResize),jQuery(".pickdate").datepicker({showOn:"button",defaultDate:"+0",dateFormat:c.dateFormat,onSelect:function(a,b){e.toDate(a)},onClose:function(a){}}).datepicker("widget").wrap('<div class="cb_hm_frontend"/>'),jQuery("#datefrom").datepicker({inline:!0,showOtherMonths:!0,changeMonth:!0,changeYear:!0,dateFormat:"dd-mm-yy",onClose:function(a,b){},onSelect:function(a){jQuery("#dateto").datepicker("option","minDate",a)}}).datepicker("widget").wrap('<div class="cb_hm_frontend"/>'),jQuery("#dateto").datepicker({inline:!0,showOtherMonths:!0,changeMonth:!0,changeYear:!0,dateFormat:"dd-mm-yy"}).datepicker("widget").wrap('<div class="cb_hm_frontend"/>'),jQuery(".saverateChanges").on("click",this,this.saveRates),jQuery(".saveLongTerm").on("click",this,this.saveRates),jQuery(".selectInLabel").on("change",function(){"close"==jQuery(this).val()?(jQuery(this).closest(".form-group").find('input[name="units"]').stop().hide(),jQuery(this).closest(".form-group").find('input[name="close"]').stop().show()):(jQuery(this).closest(".form-group").find('input[name="units"]').stop().show(),jQuery(this).closest(".form-group").find('input[name="close"]').stop().hide())})}return f.prototype.update=function(b){a.extend(!0,this,b)},f.prototype.onResize=function(){},f.prototype.resizeFunc=function(){console.log("window resized, table needed to update")},f.prototype.init=function(){this.getResult()},f.prototype.getResult=function(){e.formChange?confirm("Data modified, do you want to continue?")&&e.getRates():e.getRates()},f.prototype.getRates=function(){var a={action:this.action,from:this.dateFrom,to:this.dateTo};e.ajaxrequest||(e.formChange=!1,jQuery.ajax({type:"GET",url:this.url,data:a,beforeSend:function(){e.loadingmsg()},success:function(b){if(e.ajaxrequest=!1,jQuery(".cb_hm_ajax_message").stop().remove(),b.success)e.resultdata=b.data,e.render();else{if("-1"==b)jQuery("body").find(".cb_hm_ajaxloader").html("<div class='alert msgsboard alert-danger'>Something is wrong with form submission, please reload the page</div>");else{var c=Handlebars.compile(e.messagetemplate);jQuery(".cb_hm_ajax_message").html(c(a))}e.show_cb_hm_message(),window.setTimeout(function(){jQuery(".cb_hm_ajax_message").stop().animate({top:"-200px"},400,function(){jQuery("body").find(".cb_hm_ajax_message").stop().remove()})},2e3)}},error:function(){alert("error"),jQuery("body").find(".cb_hm_ajaxloader").stop().remove()}}))},f.prototype.render=function(){jQuery(e.toolpanel).css({opacity:1});var a=e.resultdata,b=Handlebars.compile(e.resulttemplate);jQuery("#rate-table").html(b(a)),jQuery(".calendar-prev").on("click",this.previous),jQuery(".calendar-next").on("click",this.next),jQuery('table.rate-table input.form-control[type="text"]').on("change",function(){jQuery(this).addClass("modified"),e.formChange=!0})},f.prototype.next=function(){var a=e.dateTo,c=moment(a,"D-M-YYYY").add(10,"days").format("D-M-YYYY");b={dateFrom:a,dateTo:c},e.update(b),e.getResult()},f.prototype.previous=function(){var a=e.dateFrom,c=moment(a,"D-M-YYYY").subtract("days",10).format("D-M-YYYY");b={dateFrom:c,dateTo:a},e.update(b),e.getResult()},f.prototype.toDate=function(a){var c=a,d=moment(c,"D-M-YYYY"),f=moment(e.dateFrom,"D-M-YYYY"),g=moment(e.DateTo,"D-M-YYYY");d.diff(f,"days")>0&&g.diff(d,"days")>0||(b={dateFrom:d.subtract(5,"days").format("D-M-YYYY"),dateTo:d.add(10,"days").format("D-M-YYYY")},e.update(b),e.getResult())},f.prototype.saveRates=function(b){switch(b.preventDefault(),form=jQuery(this).closest("form"),formaction=form.find('input[name="action"]').val(),formaction){case e.name+"_save_rate_changes":if(!e.formChange){var c={status:"warning",message:"Nothing Changes"};jQuery("body").append('<div class="cb_hm_ajax_message" />');var d=Handlebars.compile(e.messagetemplate);return jQuery(".cb_hm_ajax_message").html(d(c)),e.show_cb_hm_message(),window.setTimeout(function(){jQuery(".cb_hm_ajax_message").stop().animate({top:"-200px"},400,function(){jQuery("body").find(".cb_hm_ajax_message").stop().remove()})},2e3),!1}form.find('input[name="from"]').val(e.dateFrom),form.find('input[name="to"]').val(e.dateTo),c=e.pullChanges(form);break;case e.name+"_save_bulk_changes":form.find('input[name="setfor"]').val(jQuery(this).data("set"));default:c=form.serialize()}e.ajaxrequest||a.ajax({url:e.url,type:"POST",dataType:"json",data:c,beforeSend:function(){e.loadingmsg()},success:function(a){if(e.ajaxrequest=!1,a.success){switch(formaction){case e.name+"_save_bulk_changes":c=a.data;var b={dateFrom:c.from,dateTo:c.to};e.update(b),e.getResult();break;case e.name+"_save_rate_changes":form.find("input.modified").removeClass("modified"),e.formChange=!1;var d=Handlebars.compile(e.messagetemplate);jQuery(".cb_hm_ajax_message").html(d(a)),e.show_cb_hm_message();break;default:var d=Handlebars.compile(e.messagetemplate);jQuery(".cb_hm_ajax_message").html(d(a)),e.show_cb_hm_message()}window.setTimeout(function(){jQuery(".cb_hm_ajax_message").stop().animate({top:"-200px"},400,function(){jQuery("body").find(".cb_hm_ajax_message").stop().remove()})},2e3)}else{if("-1"==a)jQuery("body").find(".cb_hm_ajaxloader").html("<div class='alert msgsboard alert-danger'>Something is wrong with form submission, please reload the page</div>");else{var d=Handlebars.compile(e.messagetemplate);jQuery(".cb_hm_ajax_message").html(d(c))}e.show_cb_hm_message(),window.setTimeout(function(){jQuery(".cb_hm_ajax_message").stop().animate({top:"-200px"},400,function(){jQuery("body").find(".cb_hm_ajax_message").stop().remove()})},2e3)}},error:function(){alert("error"),jQuery("body").find(".cb_hm_ajaxloader").stop().remove()}}).done(function(){console.log("success")}).fail(function(){console.log("error"),jQuery("body").find(".cb_hm_ajaxloader").stop().remove()}).always(function(){console.log("complete")})},f.prototype.pullChanges=function(a){var b=a.find('input[type="hidden"]').serialize();return b+="&"+a.find("input.modified").serialize()},f.prototype.clear=function(){a(window).unbind("resize.cbedsRates",this.onResize)},f.prototype.show_cb_hm_message=function(){jQuery(e.toolpanel).css({opacity:1});var a=(jQuery(window).height()-jQuery(".cb_hm_ajax_message_container").outerHeight())/2,b=(jQuery(window).width()-jQuery(".cb_hm_ajax_message_container").outerWidth()-25)/2;jQuery(".cb_hm_ajax_message_container").css({left:b}),jQuery(".cb_hm_ajax_message_container").stop().animate({top:a},300)},f.prototype.loadingmsg=function(){e.ajaxrequest=!0;var a={status:"loading",message:"Please wait..."};jQuery("body").append('<div class="cb_hm_ajax_message" />');var b=Handlebars.compile(e.messagetemplate);jQuery(".cb_hm_ajax_message").html(b(a)),e.show_cb_hm_message(),jQuery(e.toolpanel).css({opacity:.5})},f}(),a.fn.cbedsRates=function(a){return this.cbedsRatesInstance?this.cbedsRatesInstance.update(a||{}):this.cbedsRatesInstance=new b(this,a||{}),this.cbedsRatesInstance.init(),this.show()},jQuery(function(){if(jQuery("#rate-table").length){var a=moment().format("D-M-YYYY"),b=moment().add(10,"days").format("D-M-YYYY");jQuery("#rate-table").cbedsRates({action:cb_hm_ajaxobj_rates.name+"_get_rates",url:cb_hm_ajaxobj_rates.url,dateFrom:a,dateTo:b,name:cb_hm_ajaxobj_rates.name})}})}(jQuery);